<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<title>abcjs: Basic Demo</title>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="css/abcjs-midi.css">
	<script src="js/abcjs_midi_5.10.2-min.js" type="text/javascript"></script>
	<script type="text/javascript">
	
		function colorRange(range, color) {
            if (range && range.elements) {
                range.elements.forEach(function (set) {
                    set.forEach(function (item) {
						item.setAttribute("fill",color);
                    });
                });
            }
        }
		
		var noteHighlight = {
			colorRange(range, color) {
				if (range && range.elements) {
					range.elements.forEach(function (set) {
						set.forEach(function (item) {
							item.setAttribute("fill",color);
						});
					});
				}
			},
			animationCallback(lastRange, currentRange, context) {
				this.colorRange(lastRange, "#000000");
				this.colorRange(currentRange, "#3D9AFC");
			}
		};
	
		var abcString = "T: Cooley's\n" +
			"M: 4/4\n" +
			"L: 1/8\n" +
			"R: reel\n" +
			"K: Emin\n" +
			"|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|\n" +
			"EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|\n" +
			"|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|\n" +
			"eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|";
			
		document.addEventListener("DOMContentLoaded", function() {
			const tunes = ABCJS.renderAbc(
				"paper",
				abcString,
				{
					add_classes: true,
					responsive: "resize",
				});
			ABCJS.renderMidi("midi", abcString,
				{
					program: 41, //violin!
					animate: { 
						/*listener: function (lastRange, currentRange, context) {
							colorRange(lastRange, "#000000");
							colorRange(currentRange, "#3D9AFC");
						},*/
						listener: noteHighlight.animationCallback.bind(noteHighlight),
						target: tunes[0], 
						qpm: 120 },
					inlineControls: {
						loopToggle: true,
					}
				});
		});

	</script>
</head>
<body>

<div id="paper"></div>
<div id="midi"></div>
</body>
</html>